<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Webmux</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar" role="navigation" aria-label="Main sidebar">
            <!-- Icon bar (left strip) -->
            <div class="sidebar-icons" role="toolbar" aria-label="Quick actions">
                <button id="toggle-sidebar" class="icon-btn" title="Collapse sidebar" aria-label="Toggle sidebar">
                    <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                        <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                    </svg>
                </button>
                <button id="open-settings" class="icon-btn" title="Settings" aria-label="Open settings">
                    <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                        <path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                    </svg>
                </button>
                <button id="toggle-scratch" class="icon-btn" title="Scratch Pad" aria-label="Toggle scratch pad">
                    <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                        <path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-2-2H7v-2h10v2zm0-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                </button>
                <button id="toggle-keybar" class="icon-btn" title="Toggle special keys bar" aria-label="Toggle special keys bar">
                    <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                        <path fill="currentColor" d="M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"/>
                    </svg>
                </button>
                <div class="sidebar-icons-spacer" aria-hidden="true"></div>
                <button id="open-logs" class="icon-btn" title="Server logs (Ctrl+Shift+L)" aria-label="Server logs">
                    <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                        <path fill="currentColor" d="M3 3h18v2H3V3zm0 4h12v2H3V7zm0 4h18v2H3v-2zm0 4h12v2H3v-2zm0 4h18v2H3v-2z"/>
                    </svg>
                </button>
                <button id="open-keybinds" class="icon-btn" title="Keyboard shortcuts (Ctrl+/)" aria-label="Keyboard shortcuts">
                    <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                        <path fill="currentColor" d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/>
                    </svg>
                </button>
            </div>

            <!-- Session panel (right side) -->
            <div class="sidebar-panel">
                <div class="sidebar-header">
                    <h2>Sessions</h2>
                </div>

                <div class="sidebar-actions">
                    <button id="new-session" class="btn btn-primary" aria-label="New terminal session">
                        <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                            <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        New Terminal
                    </button>
                </div>

                <div id="session-list" class="session-list" aria-label="Terminal session list">
                    <!-- Sessions will be populated here -->
                </div>

                <div class="sidebar-footer" role="toolbar" aria-label="File actions">
                    <button id="open-upload" class="btn btn-secondary" aria-label="Upload files">
                        <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                            <path fill="currentColor" d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/>
                        </svg>
                        Upload Files
                    </button>
                    <button id="open-download" class="btn btn-secondary" aria-label="Browse files">
                        <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                            <path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                        </svg>
                        Browse Files
                    </button>
                    <button id="clipboard-permission-btn" class="btn btn-icon btn-subtle" style="display: none;" aria-label="Enable clipboard access" title="Click to enable clipboard access for wm paste">
                        <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                            <path fill="currentColor" d="M19 2h-4.18C14.4.84 13.3 0 12 0S9.6.84 9.18 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main terminal area -->
        <main id="terminal-container" aria-label="Terminal display area">
            <div id="terminals">
                <!-- Terminal panes will be created here -->
            </div>

            <!-- Keybar for special keys -->
            <div id="keybar" class="keybar hidden" role="toolbar" aria-label="Special keys">
                <button class="keybar-btn" data-keys="C-c" title="Ctrl-C: Interrupt (SIGINT)" aria-label="Ctrl-C">
                    <span class="key-label">Ctrl-C</span>
                </button>
                <button class="keybar-btn" data-keys="C-d" title="Ctrl-D: EOF / Exit" aria-label="Ctrl-D">
                    <span class="key-label">Ctrl-D</span>
                </button>
                <button class="keybar-btn" data-keys="C-z" title="Ctrl-Z: Suspend (SIGTSTP)" aria-label="Ctrl-Z">
                    <span class="key-label">Ctrl-Z</span>
                </button>
                <button class="keybar-btn" data-keys="C-\\" title="Ctrl-\\: Quit (SIGQUIT)" aria-label="Ctrl-backslash">
                    <span class="key-label">Ctrl-\</span>
                </button>
                <button class="keybar-btn" data-keys="C-l" title="Ctrl-L: Clear screen" aria-label="Ctrl-L">
                    <span class="key-label">Ctrl-L</span>
                </button>
                <button class="keybar-btn" data-keys="C-r" title="Ctrl-R: Reverse search history" aria-label="Ctrl-R">
                    <span class="key-label">Ctrl-R</span>
                </button>
                <button class="keybar-btn" data-keys="C-u" title="Ctrl-U: Clear line" aria-label="Ctrl-U">
                    <span class="key-label">Ctrl-U</span>
                </button>
                <button class="keybar-btn" data-keys="C-w" title="Ctrl-W: Delete word" aria-label="Ctrl-W">
                    <span class="key-label">Ctrl-W</span>
                </button>
            </div>

            <!-- Mobile Bottom Toolbar -->
            <div id="mobile-bottom-toolbar" class="mobile-bottom-toolbar hidden" role="toolbar" aria-label="Mobile controls">
                <!-- Left side: Session/group controls -->
                <div class="mobile-toolbar-section mobile-toolbar-left">
                    <button id="mobile-session-picker" class="mobile-toolbar-btn" title="Current session" aria-label="Current session">
                        <span class="mobile-session-name">Terminal</span>
                        <svg class="mobile-dropdown-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                            <path fill="currentColor" d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                        </svg>
                    </button>
                </div>

                <!-- Center: Keybar (horizontal scrollable) -->
                <div class="mobile-toolbar-section mobile-toolbar-center">
                    <div class="mobile-keybar-scroll">
                        <button class="mobile-keybar-btn" data-keys="C-c" title="Ctrl-C: Interrupt" aria-label="Ctrl-C">
                            <span class="mobile-key-label">Ctrl-C</span>
                        </button>
                        <button class="mobile-keybar-btn" data-keys="C-d" title="Ctrl-D: EOF" aria-label="Ctrl-D">
                            <span class="mobile-key-label">Ctrl-D</span>
                        </button>
                        <button class="mobile-keybar-btn" data-keys="C-l" title="Ctrl-L: Clear" aria-label="Ctrl-L">
                            <span class="mobile-key-label">Ctrl-L</span>
                        </button>
                        <button class="mobile-keybar-btn" data-keys="C-r" title="Ctrl-R: Search" aria-label="Ctrl-R">
                            <span class="mobile-key-label">Ctrl-R</span>
                        </button>
                        <button class="mobile-keybar-btn" data-keys="C-z" title="Ctrl-Z: Suspend" aria-label="Ctrl-Z">
                            <span class="mobile-key-label">Ctrl-Z</span>
                        </button>
                        <button class="mobile-keybar-more" title="More keys" aria-label="More special keys">
                            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                                <path fill="currentColor" d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Right side: Scratch pad only -->
                <div class="mobile-toolbar-section mobile-toolbar-right">
                    <button id="mobile-scratch" class="mobile-toolbar-btn" title="Scratch pad" aria-label="Toggle scratch pad">
                        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                            <path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-2-2H7v-2h10v2zm0-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div id="no-session" class="no-session">
                <p>No terminal session active</p>
                <button id="create-first-session" class="btn btn-primary" aria-label="Create first terminal session">Create Terminal</button>
            </div>
        </main>

        <!-- Toast notifications -->
        <div id="toast-container" class="toast-container" aria-live="polite" role="status"></div>
    </div>

    <!-- Upload Modal -->
    <div id="upload-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="upload-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="upload-modal-title">Upload Files</h3>
                <button class="close-modal icon-btn" title="Close" aria-label="Close upload modal">
                    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="drop-zone" class="drop-zone" tabindex="0" role="button" aria-label="Drop files here or click to browse">
                    <svg viewBox="0 0 24 24" width="48" height="48" aria-hidden="true">
                        <path fill="currentColor" d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
                    </svg>
                    <p>Drag and drop files here</p>
                    <p class="or" aria-hidden="true">or</p>
                    <input type="file" id="file-input" multiple hidden aria-label="Select files to upload">
                    <button id="browse-files" class="btn btn-secondary">Browse Files</button>
                </div>
                <div class="upload-options">
                    <label for="upload-directory">
                        Upload to directory:
                    </label>
                    <input type="text" id="upload-directory" aria-label="Target directory for upload">
                </div>
                <div id="upload-progress" class="upload-progress hidden" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <p class="progress-text"></p>
                </div>
                <div id="upload-results" class="upload-results hidden" aria-live="polite"></div>
            </div>
        </div>
    </div>

    <!-- Download/Browse Modal -->
    <div id="download-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="download-modal-title">
        <!-- Marked Files Sidekick (peeks out from behind modal content) -->
        <div id="marked-sidekick" class="marked-sidekick hidden" aria-label="Marked files for download">
            <div class="marked-header">
                <h4>Marked</h4>
                <button id="mobile-marked-toggle" class="mobile-marked-toggle hidden" title="Toggle marked files" aria-label="Toggle marked files panel">
                    <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                        <path fill="currentColor" d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                    </svg>
                </button>
                <button id="clear-marked" class="icon-btn" title="Clear all" aria-label="Clear all marked files">
                    <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div id="marked-list" class="marked-list" aria-label="List of marked files">
                <!-- Marked files will be listed here -->
            </div>
            <div class="marked-footer">
                <button id="download-all-marked" class="btn btn-primary btn-sm" aria-label="Download all marked files">
                    <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
                        <path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                    </svg>
                    Download All
                </button>
            </div>
        </div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="download-modal-title">Browse Files</h3>
                <button class="close-modal icon-btn" title="Close" aria-label="Close file browser">
                    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="path-bar">
                    <input type="text" id="current-path" placeholder="/" aria-label="Current directory path">
                    <button id="go-path" class="btn btn-secondary" aria-label="Go to path">Go</button>
                </div>
                <div class="file-browser" role="grid" aria-label="File list">
                    <div class="file-header" role="row">
                        <div class="col-name sortable" data-sort="name" role="columnheader" aria-sort="ascending">
                            Name
                            <svg class="sort-icon" viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
                                <path fill="currentColor" d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                            </svg>
                        </div>
                        <div class="col-size sortable" data-sort="size" role="columnheader">
                            Size
                            <svg class="sort-icon" viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
                                <path fill="currentColor" d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                            </svg>
                        </div>
                        <div class="col-modified sortable" data-sort="date" role="columnheader">
                            Modified
                            <svg class="sort-icon" viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
                                <path fill="currentColor" d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                            </svg>
                        </div>
                        <div class="col-actions" role="columnheader"></div>
                    </div>
                    <div id="file-list" class="file-list" role="rowgroup">
                        <!-- Files will be listed here -->
                    </div>
                </div>
                <div class="file-status">
                    <span id="file-count" aria-live="polite"></span>
                </div>

                <!-- Mobile Marked Files Bar -->
                <div id="mobile-marked-bar" class="mobile-marked-bar hidden" aria-label="Marked files">
                    <button id="mobile-marked-count" class="mobile-marked-count" aria-label="Show marked files">
                        <span class="count-number">0</span>
                        <span class="count-label">marked</span>
                        <svg class="expand-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                            <path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"/>
                        </svg>
                    </button>
                    <button id="mobile-download-all" class="btn btn-primary mobile-download-btn" aria-label="Download all marked files">
                        <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                            <path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                        </svg>
                        Download All
                    </button>
                </div>

                <!-- Mobile Marked Files Drawer -->
                <div id="mobile-marked-drawer" class="mobile-marked-drawer hidden" aria-label="Marked files list">
                    <div class="mobile-marked-drawer-header">
                        <h4>Marked Files</h4>
                        <button id="mobile-marked-clear" class="icon-btn" title="Clear all" aria-label="Clear all marked files">
                            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                                <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                    <div id="mobile-marked-list" class="mobile-marked-list">
                        <!-- Marked files will be listed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Info Popup -->
    <div id="file-info-popup" class="file-info-popup hidden" role="complementary" aria-labelledby="file-info-name">
        <div class="file-info-header">
            <svg class="file-info-icon" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                <path fill="currentColor" d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
            </svg>
            <span id="file-info-name" class="file-info-name"></span>
            <button class="file-info-close icon-btn" title="Close" aria-label="Close file info">
                <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                    <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
        </div>
        <div class="file-info-details">
            <div class="file-info-row">
                <span class="file-info-label">Path</span>
                <span id="file-info-path" class="file-info-value file-info-path"></span>
            </div>
            <div class="file-info-row">
                <span class="file-info-label">Size</span>
                <span id="file-info-size" class="file-info-value"></span>
            </div>
            <div class="file-info-row">
                <span class="file-info-label">Modified</span>
                <span id="file-info-modified" class="file-info-value"></span>
            </div>
        </div>
        <div class="file-info-actions">
            <button id="file-info-copy" class="btn btn-secondary btn-sm" aria-label="Copy absolute file path">
                <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
                    <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
                Copy Path
            </button>
            <button id="file-info-scratch" class="btn btn-secondary btn-sm" aria-label="Insert path to scratch pad">
                <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
                    <path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                </svg>
                To Scratch
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settings-modal-title">
        <div class="modal-content modal-lg settings-modal">
            <div class="modal-header">
                <h3 id="settings-modal-title">Settings</h3>
                <button class="close-modal icon-btn" title="Close" aria-label="Close settings">
                    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-header">
                    <div class="settings-tabs" role="tablist">
                        <button class="settings-tab active" data-tab="ui" role="tab" aria-selected="true" aria-controls="ui-settings-panel">UI Colors</button>
                        <button class="settings-tab" data-tab="terminal" role="tab" aria-selected="false" aria-controls="terminal-settings-panel">Terminal Colors</button>
                        <button class="settings-tab" data-tab="keybar" role="tab" aria-selected="false" aria-controls="keybar-settings-panel">Keybar</button>
                    </div>
                </div>

                <div class="settings-content">
                    <!-- UI Colors Tab -->
                    <div class="settings-panel active" data-panel="ui" id="ui-settings-panel" role="tabpanel" aria-labelledby="ui-settings-tab">
                        <div class="settings-section">
                            <h4>Background Colors</h4>
                            <div class="color-grid">
                                <div class="color-input">
                                    <label for="ui-bgPrimary">Primary</label>
                                    <div class="color-input-row">
                                        <input type="color" id="ui-bgPrimary" data-setting="ui.bgPrimary" aria-label="Primary background color picker">
                                        <input type="text" data-setting-hex="ui.bgPrimary" maxlength="7" aria-label="Primary background color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="ui-bgSecondary">Secondary</label>
                                    <div class="color-input-row">
                                        <input type="color" id="ui-bgSecondary" data-setting="ui.bgSecondary" aria-label="Secondary background color picker">
                                        <input type="text" data-setting-hex="ui.bgSecondary" maxlength="7" aria-label="Secondary background color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="ui-bgTertiary">Tertiary</label>
                                    <div class="color-input-row">
                                        <input type="color" id="ui-bgTertiary" data-setting="ui.bgTertiary" aria-label="Tertiary background color picker">
                                        <input type="text" data-setting-hex="ui.bgTertiary" maxlength="7" aria-label="Tertiary background color hex code">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h4>Text Colors</h4>
                            <div class="color-grid">
                                <div class="color-input">
                                    <label for="ui-textPrimary">Primary</label>
                                    <div class="color-input-row">
                                        <input type="color" id="ui-textPrimary" data-setting="ui.textPrimary" aria-label="Primary text color picker">
                                        <input type="text" data-setting-hex="ui.textPrimary" maxlength="7" aria-label="Primary text color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="ui-textSecondary">Secondary</label>
                                    <div class="color-input-row">
                                        <input type="color" id="ui-textSecondary" data-setting="ui.textSecondary" aria-label="Secondary text color picker">
                                        <input type="text" data-setting-hex="ui.textSecondary" maxlength="7" aria-label="Secondary text color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="ui-textMuted">Muted</label>
                                    <div class="color-input-row">
                                        <input type="color" id="ui-textMuted" data-setting="ui.textMuted" aria-label="Muted text color picker">
                                        <input type="text" data-setting-hex="ui.textMuted" maxlength="7" aria-label="Muted text color hex code">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h4>Accent & Border</h4>
                            <div class="color-grid">
                                <div class="color-input">
                                    <label for="ui-accent">Accent</label>
                                    <div class="color-input-row">
                                        <input type="color" id="ui-accent" data-setting="ui.accent" aria-label="Accent color picker">
                                        <input type="text" data-setting-hex="ui.accent" maxlength="7" aria-label="Accent color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="ui-accentHover">Accent Hover</label>
                                    <div class="color-input-row">
                                        <input type="color" id="ui-accentHover" data-setting="ui.accentHover" aria-label="Accent hover color picker">
                                        <input type="text" data-setting-hex="ui.accentHover" maxlength="7" aria-label="Accent hover color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="ui-border">Border</label>
                                    <div class="color-input-row">
                                        <input type="color" id="ui-border" data-setting="ui.border" aria-label="Border color picker">
                                        <input type="text" data-setting-hex="ui.border" maxlength="7" aria-label="Border color hex code">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Terminal Colors Tab (Base24) -->
                    <div class="settings-panel" data-panel="terminal" id="terminal-settings-panel" role="tabpanel" aria-labelledby="terminal-settings-tab">
                        <p class="settings-note-inline">Colors apply to new sessions. Existing sessions keep their colors until restarted.</p>
                        <div class="settings-section">
                            <h4>Background & Foreground</h4>
                            <div class="color-grid">
                                <div class="color-input">
                                    <label for="terminal-base00">base00 (Background)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base00" data-setting="terminal.base00" aria-label="Terminal background color picker">
                                        <input type="text" data-setting-hex="terminal.base00" maxlength="7" aria-label="Terminal background color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base01">base01 (Lighter BG)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base01" data-setting="terminal.base01" aria-label="Terminal lighter background color picker">
                                        <input type="text" data-setting-hex="terminal.base01" maxlength="7" aria-label="Terminal lighter background color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base02">base02 (Selection)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base02" data-setting="terminal.base02" aria-label="Terminal selection background color picker">
                                        <input type="text" data-setting-hex="terminal.base02" maxlength="7" aria-label="Terminal selection background color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base03">base03 (Comments)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base03" data-setting="terminal.base03" aria-label="Terminal comments color picker">
                                        <input type="text" data-setting-hex="terminal.base03" maxlength="7" aria-label="Terminal comments color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base04">base04 (Dark FG)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base04" data-setting="terminal.base04" aria-label="Terminal dark foreground color picker">
                                        <input type="text" data-setting-hex="terminal.base04" maxlength="7" aria-label="Terminal dark foreground color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base05">base05 (Foreground)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base05" data-setting="terminal.base05" aria-label="Terminal foreground color picker">
                                        <input type="text" data-setting-hex="terminal.base05" maxlength="7" aria-label="Terminal foreground color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base06">base06 (Light FG)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base06" data-setting="terminal.base06" aria-label="Terminal light foreground color picker">
                                        <input type="text" data-setting-hex="terminal.base06" maxlength="7" aria-label="Terminal light foreground color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base07">base07 (Lightest)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base07" data-setting="terminal.base07" aria-label="Terminal lightest foreground color picker">
                                        <input type="text" data-setting-hex="terminal.base07" maxlength="7" aria-label="Terminal lightest foreground color hex code">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h4>Normal Colors</h4>
                            <div class="color-grid">
                                <div class="color-input">
                                    <label for="terminal-base08">base08 (Red)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base08" data-setting="terminal.base08" aria-label="Terminal red color picker">
                                        <input type="text" data-setting-hex="terminal.base08" maxlength="7" aria-label="Terminal red color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base09">base09 (Orange)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base09" data-setting="terminal.base09" aria-label="Terminal orange color picker">
                                        <input type="text" data-setting-hex="terminal.base09" maxlength="7" aria-label="Terminal orange color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base0A">base0A (Yellow)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base0A" data-setting="terminal.base0A" aria-label="Terminal yellow color picker">
                                        <input type="text" data-setting-hex="terminal.base0A" maxlength="7" aria-label="Terminal yellow color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base0B">base0B (Green)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base0B" data-setting="terminal.base0B" aria-label="Terminal green color picker">
                                        <input type="text" data-setting-hex="terminal.base0B" maxlength="7" aria-label="Terminal green color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base0C">base0C (Cyan)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base0C" data-setting="terminal.base0C" aria-label="Terminal cyan color picker">
                                        <input type="text" data-setting-hex="terminal.base0C" maxlength="7" aria-label="Terminal cyan color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base0D">base0D (Blue)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base0D" data-setting="terminal.base0D" aria-label="Terminal blue color picker">
                                        <input type="text" data-setting-hex="terminal.base0D" maxlength="7" aria-label="Terminal blue color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base0E">base0E (Magenta)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base0E" data-setting="terminal.base0E" aria-label="Terminal magenta color picker">
                                        <input type="text" data-setting-hex="terminal.base0E" maxlength="7" aria-label="Terminal magenta color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base0F">base0F (Brown)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base0F" data-setting="terminal.base0F" aria-label="Terminal brown color picker">
                                        <input type="text" data-setting-hex="terminal.base0F" maxlength="7" aria-label="Terminal brown color hex code">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h4>Extended (Base24)</h4>
                            <div class="color-grid">
                                <div class="color-input">
                                    <label for="terminal-base10">base10 (Darker BG)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base10" data-setting="terminal.base10" aria-label="Terminal darker background color picker">
                                        <input type="text" data-setting-hex="terminal.base10" maxlength="7" aria-label="Terminal darker background color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base11">base11 (Darkest BG)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base11" data-setting="terminal.base11" aria-label="Terminal darkest background color picker">
                                        <input type="text" data-setting-hex="terminal.base11" maxlength="7" aria-label="Terminal darkest background color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base12">base12 (Bright Red)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base12" data-setting="terminal.base12" aria-label="Terminal bright red color picker">
                                        <input type="text" data-setting-hex="terminal.base12" maxlength="7" aria-label="Terminal bright red color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base13">base13 (Bright Yellow)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base13" data-setting="terminal.base13" aria-label="Terminal bright yellow color picker">
                                        <input type="text" data-setting-hex="terminal.base13" maxlength="7" aria-label="Terminal bright yellow color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base14">base14 (Bright Green)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base14" data-setting="terminal.base14" aria-label="Terminal bright green color picker">
                                        <input type="text" data-setting-hex="terminal.base14" maxlength="7" aria-label="Terminal bright green color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base15">base15 (Bright Cyan)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base15" data-setting="terminal.base15" aria-label="Terminal bright cyan color picker">
                                        <input type="text" data-setting-hex="terminal.base15" maxlength="7" aria-label="Terminal bright cyan color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base16">base16 (Bright Blue)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base16" data-setting="terminal.base16" aria-label="Terminal bright blue color picker">
                                        <input type="text" data-setting-hex="terminal.base16" maxlength="7" aria-label="Terminal bright blue color hex code">
                                    </div>
                                </div>
                                <div class="color-input">
                                    <label for="terminal-base17">base17 (Bright Magenta)</label>
                                    <div class="color-input-row">
                                        <input type="color" id="terminal-base17" data-setting="terminal.base17" aria-label="Terminal bright magenta color picker">
                                        <input type="text" data-setting-hex="terminal.base17" maxlength="7" aria-label="Terminal bright magenta color hex code">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Keybar Tab -->
                    <div class="settings-panel" data-panel="keybar" id="keybar-settings-panel" role="tabpanel" aria-labelledby="keybar-settings-tab">
                        <div class="settings-section">
                            <h4>Custom Keybar Buttons</h4>
                            <p class="settings-note">Add or remove special key combinations from the keybar.</p>

                            <div class="keybar-settings-container">
                                <div id="keybar-buttons-list" class="keybar-buttons-list">
                                    <!-- Keybar buttons will be populated here -->
                                </div>

                                <div class="keybar-add-section">
                                    <div class="keybar-input-row">
                                        <input type="text" id="new-keybar-keys" placeholder="Key combo (e.g., C-c, M-x, Tab)" maxlength="20" aria-label="New key combination">
                                        <button id="add-keybar-btn" class="btn btn-primary btn-sm">Add</button>
                                    </div>
                                    <div id="keybar-input-error" class="keybar-input-error hidden"></div>
                                </div>
                            </div>

                            <div class="keybar-examples">
                                <h5>Examples:</h5>
                                <div class="example-grid">
                                    <div class="example-item">
                                        <code>C-c</code> - Ctrl+C
                                    </div>
                                    <div class="example-item">
                                        <code>M-x</code> - Alt+X
                                    </div>
                                    <div class="example-item">
                                        <code>C-S-c</code> - Ctrl+Shift+C
                                    </div>
                                    <div class="example-item">
                                        <code>F1</code> - Function key
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-footer">
                    <div class="settings-actions">
                        <div id="settings-theme-actions" class="btn-group" role="group" aria-label="Configuration import/export">
                            <button id="settings-import" class="btn btn-secondary">Paste</button>
                            <button id="settings-export" class="btn btn-secondary">Copy</button>
                        </div>
                        <div class="btn-group" role="group" aria-label="Settings actions">
                            <button id="settings-reset" class="btn btn-secondary">Reset</button>
                            <button id="settings-save" class="btn btn-primary">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Keybinds Modal -->
    <div id="keybinds-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="keybinds-modal-title">
        <div class="modal-content modal-sm keybinds-modal">
            <div class="modal-header">
                <h3 id="keybinds-modal-title">Keyboard Shortcuts</h3>
                <button class="close-modal icon-btn" title="Close" aria-label="Close shortcuts">
                    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="keybinds-section">
                    <h4>Application</h4>
                    <div class="keybind-row">
                        <span class="keybind-desc">New terminal</span>
                        <span class="keybind-keys"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>T</kbd></span>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-desc">Show keyboard shortcuts</span>
                        <span class="keybind-keys"><kbd>Ctrl</kbd>+<kbd>/</kbd></span>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-desc">Show server logs</span>
                        <span class="keybind-keys"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>L</kbd></span>
                    </div>
                </div>
                <div class="keybinds-section">
                    <h4>Terminal</h4>
                    <div class="keybind-row">
                        <span class="keybind-desc">Copy selection</span>
                        <span class="keybind-keys"><kbd>Shift</kbd>+<span class="keybind-note">select</span></span>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-desc">Paste from clipboard</span>
                        <span class="keybind-keys"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>V</kbd></span>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-desc">Scroll up</span>
                        <span class="keybind-keys"><kbd>Shift</kbd>+<kbd>PgUp</kbd></span>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-desc">Scroll down</span>
                        <span class="keybind-keys"><kbd>Shift</kbd>+<kbd>PgDn</kbd></span>
                    </div>
                </div>
                <div class="keybinds-section">
                    <h4>Special Keys (Keybar)</h4>
                    <p class="keybind-note" style="margin-bottom: 8px;">Use the keybar at the bottom of the terminal to send special keys without browser conflicts.</p>
                    <div class="keybind-row">
                        <span class="keybind-desc">Interrupt (SIGINT)</span>
                        <span class="keybind-keys"><kbd>Ctrl-C</kbd></span>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-desc">EOF / Exit</span>
                        <span class="keybind-keys"><kbd>Ctrl-D</kbd></span>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-desc">Suspend (SIGTSTP)</span>
                        <span class="keybind-keys"><kbd>Ctrl-Z</kbd></span>
                    </div>
                    <div class="keybind-row">
                        <span class="keybind-desc">Reverse history search</span>
                        <span class="keybind-keys"><kbd>Ctrl-R</kbd></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logs Modal -->
    <div id="logs-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="logs-modal-title">
        <div class="modal-content modal-lg logs-modal">
            <div class="modal-header">
                <h3 id="logs-modal-title">Server Logs</h3>
                <div class="logs-header-actions">
                    <label class="logs-auto-refresh">
                        <input type="checkbox" id="logs-auto-refresh" checked>
                        <span>Auto-refresh</span>
                    </label>
                    <button id="logs-refresh" class="btn btn-secondary btn-sm" title="Refresh logs">
                        <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                            <path fill="currentColor" d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                        </svg>
                    </button>
                    <button class="close-modal icon-btn" title="Close" aria-label="Close logs">
                        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="modal-body logs-body">
                <pre id="logs-content" class="logs-content"></pre>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
